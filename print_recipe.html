<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>福润堂 小票打印</title>
  <script type="text/javascript" src="lib/angular.js"></script>
  <script type="text/javascript" src="js/FRT_cashier.js"></script>
   
</head>
<body ng-app="ngApp" ng-controller="Ctrl" style="font-size:14px;">
  <center><h1>福润堂</h1> </center>
  门诊号：{{data.case_no}} 
    <table border="0" width="180">
      <tr><td width="30"></td>
      <td width="100">药名</td>
      <td width="50">用量</td></tr>  

      <tr ng-repeat="obj in data.case.recipe">
        <td> {{$index+1}} &nbsp; </td>
        <td>{{obj.medicine_name}}</td>
        <td>{{obj.count}}</td>
      </tr>
    </table>
    <br>
      单付价格：{{data.case.suitprice}}  <br>
      付数：{{data.case.suitcount}}<br>
      总价：{{data.case.sumprice}}<br>
      支付方式： {{data.case.pay_type}}<br>
      收入： {{data.case.shouru}}<br>
      找零： {{data.case.zhaoling}}<br>
      
    
     
    
  
<script type="text/javascript">
  var url_param = location.href.substring(location.href.indexOf("?")+1);
  url_param = decodeURI(url_param);
  var params = url_param.split(",");

  var binglihao = params[0];
  console.log(binglihao);

  var ngApp = angular.module('ngApp', []);

  function Ctrl($scope) {
    
    $scope.dummy = "will";
    
    $scope.data = {};
    $scope.data.patient = {};
    $scope.data.recipe = {};
    $scope.data.recipe.items = [];

    $scope.data.suitprice = 0;
    $scope.data.suitcount = 0;
    $scope.data.sumprice = 0;
    $scope.shouru = 0;

    

    $scope.go_case_no = function(){
      
      var filename = "./data/recipe/" + $scope.case_no + ".json";
      if( fs.existsSync( filename) ){
        $scope.data = readFileToJson(filename);
      }
    };

    $scope.case_no=binglihao;
    //$scope.$apply();
    $scope.go_case_no();
  }

  setTimeout(function(){
                          window.print();  
                       },1000);


  

  </script>
</body>
</html>




